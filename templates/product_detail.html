{%extends "layout.html"%}
{% block title %}상품 세부조회 | EWHA MARKET{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/product_style.css') }}">
{% endblock %}

{% block content %}
<div class="product-detail-page">
    <div class="title">Products</div>
    <hr/>
    <section class="detail">
        <!-- 왼쪽: 상품 이미지 -->
        <div class="thumb-lg">
            {% if product.img_path %}
            <img alt="상품 이미지" id="product-image"
                 src="{{ url_for('static', filename='images/' ~ product.img_path) }}">
            {% else %}
            <div class="thumb-lg placeholder" aria-label="이미지 없음"></div>
            {% endif %}
        </div>
        <!-- 오른쪽: 상품 정보 -->
        <div class="info">
            <div class="badge" id="product-category">{{ product.category or '기타' }}</div>
            <div class="name" id="product-name">{{ product.name or '상품명 없음' }}</div>
            <div class="seller">판매자: <span id="product-seller">{{ product.seller or '알수없음' }}</span></div>
            <div class="price" id="product-price">₩{{ product.price or 0 }}</div>
            {% if product.tags %}
            <div class="subnote" id="product-tags">{{ product.tags }}</div>
            {% endif %}
            {% if product.method %}
            <div class="subnote" id="product-method">거래 방법: {{ product.method }}</div>
            {% endif %}
            {% if product.quantity is defined and product.quantity|int < 5 %}
            <div style="color:#d60000; font-weight:600; margin-top:8px;">
                현재 이 상품의 재고가 {{ product.quantity }}개 남았습니다!
            </div>
            {% endif %}
            <div class="actions">
                <div class="wish-heart" id="wish-btn">
                     <i class="fa-regular fa-heart"></i>
                </div>
                <a href="#구매창">
                    <button class="btn btn-buy" type="button">바로 구매</button>
                </a>
                <a href="{{ url_for('reviews.reg_review_get', item_id=product.id) }}">
                    <button class="btn btn-review" type="button">리뷰 작성</button>
                </a>
            </div>
            {% if is_owner %}
            <div class="seller_actions">
                <a href="{{url_for('items.edit_product', product_id=product_id, slug=product.name) }}">
                    <button class="btn btn-edit" id="btn-edit" type="button">수정하기</button>
                </a>
                <a href="{{url_for('items.delete_product', product_id=product_id, slug=product.name) }}">
                    <button class="btn btn-buy" id="btn-delete" type="button">삭제하기</button>
                </a>
            </div>
            {% endif %}
        </div>
    </section>
    <section class="desc-wrap">
        <div class="desc-title">상품 설명</div>
        <div class="desc-body" id="product-description">
            {{ product.details or '상세 설명이 없습니다.' }}
        </div>
    </section>
</div>
{% endblock %}

{% block script %}
    <script>
        document.getElementById("btn-delete")?.addEventListener("click", function () {
        const confirmed = confirm("정말 이 상품을 삭제하시겠습니까?");
        if (!confirmed) return;  // NO → 취소

        // YES → 실제 삭제 요청 보내기
        const productId = "{{ product_id }}";
        const slug = "{{ product.name }}";

        // Flask의 delete 라우트로 이동
        window.location.href = `/products/${productId}/${slug}/delete`;
    });
        document.addEventListener("DOMContentLoaded", () => {
            const wishBtn = document.getElementById("wish-btn");
            const icon = wishBtn.querySelector("i");

            wishBtn.addEventListener("click", () => {
                wishBtn.classList.toggle("active");

                if (wishBtn.classList.contains("active")) {
                    icon.classList.remove("fa-regular");
                    icon.classList.add("fa-solid");
                } else {
                    icon.classList.remove("fa-solid");
                    icon.classList.add("fa-regular");
                }
            });
        });
  </script>
{% endblock %}
