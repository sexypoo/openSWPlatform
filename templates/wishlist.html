{%extends "layout.html"%}
{% block title %}ìœ„ì‹œë¦¬ìŠ¤íŠ¸ | EWHA MARKET{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/product_style.css') }}">
{% endblock %}

{% block content %}
<div class="wishlist-page">
  <div class="title">Wishlist</div>
  <hr/>
  <section class="grid" id="wishlistGrid">
  <!-- ì¹´ë“œë“¤ì´ JSë¡œ ìë™ ìƒì„±ë¨ -->
  </section>
  </div>
</div>

{% endblock %}

{% block script %}
<script>
    localStorage.setItem("wishlist", JSON.stringify([1, 2, 3]));
  // ğŸ’¾ ì„ì‹œ ìƒí’ˆ ë°ì´í„° (ì‹¤ì œë¡œëŠ” DBì—ì„œ ë¶ˆëŸ¬ì˜¬ ìˆ˜ë„ ìˆìŒ)
  const products = [
    { id: 1, name: "Product 1", price: 29000 },
    { id: 2, name: "Product 2", price: 18000 },
    { id: 3, name: "Product 3", price: 45000 },
    { id: 4, name: "Product 4", price: 12000 },
    { id: 5, name: "Product 5", price: 63000 },
    { id: 6, name: "Product 6", price: 22000 },
    { id: 7, name: "Product 7", price: 39000 },
    { id: 8, name: "Product 8", price: 49000 },
    { id: 9, name: "Product 9", price: 15000 },
  ];

  // ğŸ’– LocalStorageì— ì €ì¥ëœ ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°
  let wishlist = JSON.parse(localStorage.getItem("wishlist")) || [];

  // ğŸ–¼ï¸ í™”ë©´ì— ìƒí’ˆ ì¹´ë“œ ìƒì„±
  const grid = document.getElementById("wishlistGrid");

  function renderProducts() {
    grid.innerHTML = ""; // ì´ˆê¸°í™”
    const visibleProducts = products.filter(p => wishlist.includes(p.id));

    if (visibleProducts.length === 0) {
      grid.innerHTML = "<p>ìœ„ì‹œë¦¬ìŠ¤íŠ¸ê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.</p>";
      return;
    }

    visibleProducts.forEach(p => {
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <a href="detail.html">
          <div class="thumb" aria-label="ìƒí’ˆ ì´ë¯¸ì§€">
            <span class="heart ${wishlist.includes(p.id) ? "" : "inactive"}" data-id="${p.id}">â¤ï¸</span>
          </div>
          <div class="meta">
            <div class="name">${p.name}</div>
            <div class="price">â‚©${p.price.toLocaleString()}</div>
          </div>
        </a>
      `;
      grid.appendChild(card);
    });

    attachHeartEvents();
  }

  // ğŸ’¡ í•˜íŠ¸ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
  function attachHeartEvents() {
    const hearts = document.querySelectorAll(".heart");
    hearts.forEach(heart => {
      heart.addEventListener("click", e => {
        e.preventDefault(); // ë§í¬ í´ë¦­ ë°©ì§€
        const id = parseInt(heart.dataset.id);

        if (wishlist.includes(id)) {
          // ì´ë¯¸ ìœ„ì‹œë¦¬ìŠ¤íŠ¸ì— ìˆìŒ â†’ ì œê±°
          wishlist = wishlist.filter(x => x !== id);
          heart.classList.add("inactive");
        } else {
          // ì—†ìœ¼ë©´ ì¶”ê°€
          wishlist.push(id);
          heart.classList.remove("inactive");
        }

        // ë³€ê²½ì‚¬í•­ ì €ì¥
        localStorage.setItem("wishlist", JSON.stringify(wishlist));
        renderProducts(); // ìƒˆë¡œê³ ì¹¨ ì—†ì´ ì¦‰ì‹œ ë°˜ì˜
      });
    });
  }

  // ğŸš€ í˜ì´ì§€ ë¡œë“œ ì‹œ ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ë Œë”ë§
  renderProducts();
</script>
{% endblock %}