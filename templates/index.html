{% extends "layout.html" %}
{% block title %}홈 | EWHA MARKET{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/userhome_style.css') }}">
{% endblock %}


{% block content %}
<!-- 메인 배너(이미지) -->
<section class="intro">
    <img src="./static/images/intro.png" alt="EWHA MARKET 소개 이미지" class="intro-img">
</section>

<!-- Latest Products -->
<section class="latest-section">
    <div class="section-header">
        <h2>Latest Products</h2>
        <p>최신 등록 상품</p>
    </div>
    <div class="card-container">
        {% if latest_products %}
        {% for p in latest_products %}

        {# 안전 가드: 값이 없으면 기본값으로 대체 #}
        {% set name = p.name | default(p.id) %}
        {% set img = p.img_path| default('') %}
        {% set details = p.details | default('', true) %}
        {% set price = p.price | default(0) %}

        <div class="product-card">
            <a href="{{ url_for('items.view_product', product_id=p.id, slug=p.name) }}">
                <div class="img-placeholder"
                     {% if img %}
                     style="background-image:url('{{ url_for('static', filename='images/' ~ img) }}'); background-size:cover; background-position:center;"
                     {% endif %}>
                </div>
                <h3>{{ name }}</h3>
                <p>{{ details[:20] }}{% if details %}...{% endif %}</p>
                <span>₩{{ price }}</span>
            </a>
        </div>

        {% endfor %}
        {% else %}
        <p>등록된 상품이 없습니다.</p>
        {% endif %}
        <div class="more-icon" onclick="location.href='{{ url_for('items.view_products') }}'">
            <i class="fa-solid fa-arrow-right"></i>
            <p>더보기</p>
        </div>
    </div>
</section>

<!-- Latest Reviews -->
<section class="latest-section">
    <div class="section-header">
        <h2>Latest Reviews</h2>
        <p>최신 등록 리뷰</p>
    </div>
    <div class="card-container">
        {% if latest_reviews %}
        {% for r in latest_reviews %}

        {# 안전 가드: 값이 없으면 기본값으로 대체 #}
        {% set name = r.title | default(r.id) %}
        {% set img = r.images[0] | default('') %}
        {% set details = r.review_details | default('', true) %}
        {% set star = r.rating|int or 0 %}

        <div class="product-card">
            <a href="{{ url_for('reviews.view_review', review_id=r.id, slug=r.name) }}">
                <div class="img-placeholder"
                     {% if img %}
                     style="background-image:url('{{ url_for('static', filename='images/' ~ img) }}'); background-size:cover; background-position:center;"
                     {% endif %}>
                </div>
                <h3>{{ name }}</h3>
                <p>{{ details[:20] }}{% if details %}...{% endif %}</p>
                <p>{{ '★' * star }}{{ '☆' * (5 - star) }}</p>
            </a>
        </div>

        {% endfor %}
        {% else %}
        <p>등록된 상품이 없습니다.</p>
        {% endif %}
        <div class="more-icon" onclick="location.href='{{ url_for('reviews.view_reviews') }}'">
            <i class="fa-solid fa-arrow-right"></i>
            <p>더보기</p>
        </div>
    </div>
</section>
{% endblock %}